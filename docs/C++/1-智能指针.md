---
title: 智能指针
description: 关于智能指针的一些认识
tags: C++, 智能指针, 指针 
# 默认打开评论
comment: true
date: 2023-10-04
outline: [2, 3]
---

## 动态内存与智能指针

C++的动态内存管理通过一对运算符完成: new, delete

`添加头文件<memory>中启动`

### new

在动态内存中为对象分配空间并返回一个指向该对象的指针，我们可以选择对象进行初始化

### delete

接受一个动态对象的指针，销毁该对象，并释放与之关联的内存

### shared_ptr

允许多个指针指向一个对象

### unique_ptr

“独占”所指对象

### weak_ptr

弱引用，指向 shared_ptr 所管理的对象

## shared_ptr 指针

采用模板创建

```cpp
shared_ptr<string> p1;
shared_ptr<list<int>> p2
```

### make_shared 函数

```cpp
// 指向一个值为42的int的shared_ptr
shared_ptr<int> p3 = make_shared<int>(42);
// 指向一个值为9999999999的string的shared_ptr
shared_ptr<string> p4 = make_shared<string>(10,'9');
// 指向一个初始化值为0的int的shared_ptr
shared_ptr<int> p5 = make_shared<int>();
```

通常使用 auto 来保存 make_shared 的结果

### shared_ptr 的拷贝与赋值

当进行拷贝或赋值操作时,每个 shared_ptr 都会记录有多少个其他 shared_ptr 指向相同的对象

```cpp
// p指向的对象只有p一个引用者
auto p = make_shared<int>(42);
// p和q指向相同对象，此对象有两个引用者
auto q(p);
```

可以认为：每个 shared_ptr 都有一个关联的计数器——引用计数器(reference count)。无论何时，拷贝一个 shared_ptr，计数器都会增加  
以下情况计数器递增：

- 当用一个 shared_ptr 初始化另一个 shared_ptr
- 将它作为一个参数传递给一个函数
- 作为函数的返回值时

以下情况计数器递减：

- 给 shared_ptr 赋予新值时
- shared_ptr 被销毁时（局部的 shared_ptr 离开其作用域时）

### shared_ptr 自动销毁


